<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>T√∫i ƒê·ªì C·ªßa B√©</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS RI√äNG CHO INVENTORY --- */
        :root {
            --doraemon-blue: #0076c8;
            --doraemon-red: #ff3c30;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .item-card {
            background: #E3F2FD; 
            border: 3px solid var(--doraemon-blue);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #90CAF9;
        }

        .item-card:hover {
            transform: translateY(-5px);
            border-color: var(--doraemon-red);
            box-shadow: 0 8px 0 #EF9A9A;
        }

        .item-card img {
            width: 90px;
            height: 90px;
            object-fit: contain;
            transition: transform 0.3s;
        }

        .item-card:hover img {
            transform: scale(1.1) rotate(-5deg);
        }

        .item-name {
            font-weight: 800;
            color: var(--doraemon-blue);
            margin-top: 10px;
            font-size: 0.95rem;
        }

        .quantity-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--doraemon-red);
            color: white;
            border: 3px solid #fff;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            font-weight: 900;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 10;
        }

        /* --- MODAL POPUP --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 2000;
            backdrop-filter: blur(3px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .item-modal {
            background: white;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: scale(0.7);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--doraemon-blue);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .modal-overlay.active .item-modal { transform: scale(1); }

        .item-modal img {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin-bottom: 20px;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.1));
        }

        .modal-btn {
            background: var(--doraemon-blue);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            font-size: 1rem;
        }
        .modal-btn:hover { background: #0060a0; }
        
        .close-modal {
            background: #ccc;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    {% include '_header_2.html' %}
    
    <main class="container">
        <h2>üéí T√∫i ƒê·ªì C·ªßa B√©</h2>
        
        <div class="inventory-grid">
            {% for item_inv in user_inventory %}
                {% set info = item_data.get(item_inv.item_id) %}
                
                {% if info %}
                <div class="item-card" 
                     data-name="{{ info.name }}"
                     data-img="{{ url_for('static', filename='img/' + info.img) }}"
                     data-qty="{{ item_inv.quantity }}"
                     onclick="openItemModal(this)">
                    
                    <div class="quantity-badge">{{ item_inv.quantity }}</div>
                    <img src="{{ url_for('static', filename='img/' + info.img) }}" alt="{{ info.name }}">
                    <div class="item-name">{{ info.name }}</div>
                </div>
                {% endif %}
            {% else %}
                <div style="grid-column: 1/-1; text-align: center; margin-top: 50px;">
                    <p style="font-size: 1.2rem; color: #777;">T√∫i ƒë·ªì ƒëang tr·ªëng tr∆°n √†! <br> H√£y ch∆°i game ki·∫øm ƒëi·ªÉm v√† gh√© C·ª≠a h√†ng nh√©!</p>
                    <a href="{{ url_for('shop') }}" class="modal-btn" style="text-decoration: none; display: inline-block; margin-top: 20px;">üõçÔ∏è ƒêi mua s·∫Øm</a>
                </div>
            {% endfor %}
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <a href="{{ url_for('shop') }}" style="color: var(--doraemon-blue); font-weight: bold; text-decoration: none;">&larr; Quay l·∫°i C·ª≠a H√†ng</a>
        </div>
    </main>

    <div id="itemModal" class="modal-overlay" onclick="closeModal(event)">
        <div class="item-modal">
            <h3 id="modalTitle" style="color: var(--doraemon-blue); font-size: 1.5rem; margin-bottom: 15px;">T√™n v·∫≠t ph·∫©m</h3>
            <img id="modalImg" src="" alt="">
            <p>B·∫°n ƒëang s·ªü h·ªØu: <strong id="modalQty" style="font-size: 1.5rem; color: var(--doraemon-red);">0</strong> c√°i</p>
            <p style="color: #666; font-size: 0.95rem; margin: 15px 0;">
                "B·∫£o b·ªëi th·∫ßn k·ª≥ gi√∫p b√© h·ªçc gi·ªèi h∆°n!"
            </p>
            <div>
                <button class="modal-btn" onclick="useItem()">‚ú® S·ª≠ d·ª•ng</button>
                <button class="modal-btn close-modal" onclick="document.getElementById('itemModal').classList.remove('active')">ƒê√≥ng</button>
            </div>
        </div>
    </div>



    <script>
        // H√†m n√†y gi·ªù nh·∫≠n v√†o ch√≠nh ph·∫ßn t·ª≠ (this) ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ data-*
        function openItemModal(element) {
            // L·∫•y d·ªØ li·ªáu an to√†n t·ª´ thu·ªôc t√≠nh data
            const name = element.getAttribute('data-name');
            const imgSrc = element.getAttribute('data-img');
            const qty = element.getAttribute('data-qty');

            // C·∫≠p nh·∫≠t giao di·ªán Modal
            document.getElementById('modalTitle').innerText = name;
            document.getElementById('modalImg').src = imgSrc;
            document.getElementById('modalQty').innerText = qty;
            
            // Hi·ªÉn th·ªã Modal
            document.getElementById('itemModal').classList.add('active');
        }

        function closeModal(event) {
            if (event.target.classList.contains('modal-overlay')) {
                document.getElementById('itemModal').classList.remove('active');
            }
        }

        function useItem() {
            alert("Doraemon ƒëang l√¥i b·∫£o b·ªëi ra... \n(T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c Nobita ph√°t tri·ªÉn hihi)");
            document.getElementById('itemModal').classList.remove('active');
        }
    </script>
</body>
</html>